<!DOCTYPE html>
<html>
    <head>
        <style>
            .tree_node + ul{
                display: none;
            }
            .tree_node.show + ul{
                display: block;
            }            
        </style>
    </head>
    <body>
        1008...
        <tree-componenet></tree-componenet>
        <script>
            class tree extends HTMLElement{
                constructor(){
                    super();
                }

                connectedCallback(){
                    this.render();
                    this.pidArray = [];
                }

                async getDataFromServer(){
                    // let response = await fetch('http://192.168.0.51:5000/dataFromServer');
                    // let response = await fetch('http://192.168.56.1:5000/dataFromServer');
                    let response = await fetch(`http://192.168.56.1:5000/dataFromDb?query=WITH recursive cte (id, pid, NAME, description) as(
                                                    SELECT id, pid, NAME, description
                                                    FROM tree_table
                                                    WHERE id=1
                                                    UNION all
                                                    SELECT a.id, a.pid, a.name, a.description
                                                    FROM tree_table a
                                                    INNER JOIN cte
                                                    ON a.pid = cte.id
                                                )
                                                SELECT * FROM cte ORDER BY pid asc, id asc;`);
                    let responseJson = await response.json();
                    this.initialData = responseJson;
                    console.log(this.initialData); // Type : object
                }

                async render(){
                    await this.getDataFromServer();
                    this.constructTreeWithInitialData();
                }

                constructTreeWithInitialData(){
                    let copiedData = this.initialData;
                    while(copiedData.length!=0){
                        let tempObject = copiedData.shift();
                        this.addItem(tempObject);
                    }
                }

                addItem(elementData){
                    console.log(elementData);
                    let tempElement = document.createElement('span');
                    tempElement.innerText = elementData['NAME'];
                    tempElement.setAttribute('data-id', elementData['id']);
                    tempElement.setAttribute('data-pid', elementData['pid']);
                    tempElement.setAttribute('data-name', elementData['NAME']);
                    tempElement.setAttribute('data-description', elementData['description']);
                    
                    if(!this.pidArray.includes(elementData['pid'])){
                        this.appendChild(tempElement);
                    }else{ // pid가 존재하는 경우에 ...
                        console.log('this element has parents');
                        
                        //ul 태그가 존재한다면 ...
                        //ul 태그가 없는지 ...
                    }
                    this.pidArray.push(elementData.id);
                }
            }
            customElements.define('tree-componenet', tree);
        </script>
    </body>
</html>